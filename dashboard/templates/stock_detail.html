{% extends "base.html" %}

{% block title %}{{ stock_info.ticker }} - Stock Detail{% endblock %}

{% block content %}
<div class="stock-detail">
    <div class="breadcrumb">
        <a href="{{ url_for('index') }}">← Back to Dashboard</a>
    </div>

    <div class="stock-header">
        <h2>{{ stock_info.ticker }} - {{ stock_info.company_name }}</h2>
        <p class="stock-meta">
            <span>{{ stock_info.sector or 'N/A' }}</span> • 
            <span>{{ stock_info.industry or 'N/A' }}</span> • 
            <span>{{ stock_info.country or 'N/A' }}</span>
        </p>
    </div>

    <!-- Time Range Selector -->
    <div class="time-range-selector" style="margin: 20px 0;">
        <label for="timeRange" style="font-weight: bold; margin-right: 10px;">Time Range:</label>
        <select id="timeRange" onchange="changeTimeRange()" style="padding: 8px 12px; font-size: 14px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="all" {% if time_range == 'all' %}selected{% endif %}>All Time</option>
            <option value="1m" {% if time_range == '1m' %}selected{% endif %}>1 Month</option>
            <option value="3m" {% if time_range == '3m' %}selected{% endif %}>3 Months</option>
            <option value="6m" {% if time_range == '6m' %}selected{% endif %}>6 Months</option>
            <option value="1y" {% if time_range == '1y' %}selected{% endif %}>1 Year</option>
            <option value="2y" {% if time_range == '2y' %}selected{% endif %}>2 Years</option>
            <option value="5y" {% if time_range == '5y' %}selected{% endif %}>5 Years</option>
        </select>
    </div>

    <script>
        function changeTimeRange() {
            const select = document.getElementById('timeRange');
            const selectedRange = select.value;
            const currentUrl = window.location.pathname;
            window.location.href = currentUrl + '?range=' + selectedRange;
        }
    </script>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>${{ stats.latest_price }}</h3>
            <p>Current Price</p>
        </div>
        <div class="stat-card">
            <h3>${{ stats.avg_price }}</h3>
            <p>Average Price</p>
        </div>
        <div class="stat-card">
            <h3>${{ stats.max_price }}</h3>
            <p>High</p>
        </div>
        <div class="stat-card">
            <h3>${{ stats.min_price }}</h3>
            <p>Low</p>
        </div>
        <div class="stat-card">
            <h3>{{ stats.avg_volume }}</h3>
            <p>Avg Volume</p>
        </div>
    </div>

    <div class="section">
        <h3>Price History</h3>
        {{ price_chart|safe }}
    </div>

    <div class="section">
        <h3>Trading Volume</h3>
        {{ volume_chart|safe }}
    </div>

    <div class="section">
        <h3>SEC Filings</h3>
        {% if sec_filings and sec_filings|length > 0 %}
        <div class="table-scroll">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Filing Type</th>
                        <th>Filing Date</th>
                        <th>Accession Number</th>
                        <th>Document</th>
                    </tr>
                </thead>
                <tbody>
                    {% for filing in sec_filings %}
                    <tr>
                        <td><span class="filing-badge">{{ filing.filing_type }}</span></td>
                        <td>{{ filing.filing_date }}</td>
                        <td><code style="font-size: 0.85em;">{{ filing.accession_number }}</code></td>
                        <td>
                            {% if filing.filing_url %}
                            <a href="{{ filing.filing_url }}" target="_blank" class="btn-link">View on SEC.gov →</a>
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color: #666; font-style: italic; padding: 20px;">No SEC filings available for this ticker. Run the SEC pipeline to fetch filings.</p>
        {% endif %}
    </div>

    <div class="section">
        <h3>Historical Data</h3>
        <div class="table-scroll">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Open</th>
                        <th>High</th>
                        <th>Low</th>
                        <th>Close</th>
                        <th>Volume</th>
                        <th>Change %</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in price_data|reverse %}
                    <tr>
                        <td>{{ row.date }}</td>
                        <td>${{ "%.2f"|format(row.open_price) }}</td>
                        <td>${{ "%.2f"|format(row.high_price) }}</td>
                        <td>${{ "%.2f"|format(row.low_price) }}</td>
                        <td>${{ "%.2f"|format(row.close_price) }}</td>
                        <td>{{ "{:,.0f}".format(row.volume) }}</td>
                        <td class="{% if row.price_change_percent > 0 %}positive{% else %}negative{% endif %}">
                            {{ "%.2f"|format(row.price_change_percent) }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.filing-badge {
    display: inline-block;
    padding: 4px 10px;
    background: #dbeafe;
    color: #1e40af;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.9em;
}

.btn-link {
    color: #2563eb;
    text-decoration: none;
    font-weight: 500;
}

.btn-link:hover {
    text-decoration: underline;
}
</style>
{% endblock %}
